<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.example.engTest.mapper.MaterialMapper">

    <resultMap id="materialResultMap" type="com.example.engTest.dto.RoundMaterial">
        <id property="id" column="id"/>
        <result property="roundId" column="round_id"/>
        <result property="materialType" column="material_type"/>
        <result property="title" column="title"/>
        <result property="url" column="url"/>
        <result property="fileName" column="file_name"/>
        <result property="seqNo" column="seq_no"/>
        <result property="createdAt" column="created_at"/>
    </resultMap>

    <select id="findByRoundId" resultMap="materialResultMap">
        SELECT * FROM round_materials WHERE round_id = #{roundId} ORDER BY seq_no, id
    </select>

    <select id="findById" resultMap="materialResultMap">
        SELECT * FROM round_materials WHERE id = #{id}
    </select>

    <insert id="insert" useGeneratedKeys="true" keyProperty="id">
        INSERT INTO round_materials (round_id, material_type, title, url, file_name, seq_no)
        VALUES (#{roundId}, #{materialType}, #{title}, #{url}, #{fileName}, #{seqNo})
    </insert>

    <delete id="delete">
        DELETE FROM round_materials WHERE id = #{id}
    </delete>

    <delete id="deleteByRoundId">
        DELETE FROM round_materials WHERE round_id = #{roundId}
    </delete>

    <select id="getMaxSeqNo" resultType="int">
        SELECT COALESCE(MAX(seq_no), 0) FROM round_materials WHERE round_id = #{roundId}
    </select>

</mapper>
